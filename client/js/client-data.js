class ClientData {	constructor() {		this.person_id = null;		this.persons = null;		this.telephones = null;		this.teltypes = null;	}	getCurrentPerson() {		return this.getPerson(this.person_id);	}		getPerson(person_id) {		for(var i=0; i < this.persons.length; i++) {			if(this.persons[i].ID == person_id) {				return this.persons[i];			}		}		return null;	}	getTelephone(telephone_id) {		for(var i=0; i < this.telephones.length; i++) {			if(this.telephones[i].ID == telephone_id) {				return this.telephones[i];			}		}		return null;	}		getTelType(id) {		for(var i=0; i < this.teltypes.length; i++) {			if(this.teltypes[i].ID == id) {				return this.teltypes[i];			}		}		return null;	}		loadTeltypes() {		var self = this;		$.get('/teltypes').done(function(data) {			self.teltypes = data.teltypes;		});	}}// PERSONSfunction reload_persons() {	$.get('/persons').done(function(data) {		DATA.persons = data.persons;		render_persons();	}).fail(function(response) {		var data = response.responseJSON;		$('#persons').html(render_messages(data.messages));	});}function render_persons() {	var html = '';	html += "<table class='grid'>";	html += "<tr><th>ID</th><th>NAME</th><th>ADDRESS</th><th></th></tr>";	for(var i=0; i<DATA.persons.length; i++) {		var p = DATA.persons[i];		var css = (DATA.person_id === p.ID) ? 'selected' : '';		html += "<tr class='" + css + "'>" +			"<td>" + p.ID + "</td>" +			"<td><a href='#' data-id='" + p.ID + "' class='icon user_icon person-telephones'>" +				html_escape(p.NAME + " " + p.FAM) +			"</a></td>"+			"<td>" + html_escape(p.ADDRESS) + "</td>" +			"<td>" +				"<a href='#' data-id='" + p.ID + "' class='icon edit_icon person-edit'>Edit</a> " +				"<a href='#' data-id='" + p.ID + "' class='icon delete_icon person-delete'>Delete</a>" +			"</td>" +		"</tr>";	}	html += "</table>";	$('#persons').html(html);}	function render_person_form(person) {	var html = '';	var title = (person.ID) ? 'Edit Person' : 'Add Person';		html += "<h1>" + title + "</h1>";	html += "<form id='person-edit-form' action='#' method='post'>";	html += "<p><label>ID</label><input name='ID' class='txt medium' value='" + html_escape(person.ID) + "' readonly /></p>";	html += "<p><label>NAME</label><input name='NAME' class='txt medium' value='" + html_escape(person.NAME) + "'/></p>";	html += "<p><label>FAM</label><input name='FAM' class='txt medium' value='" + html_escape(person.FAM) + "'/></p>";	html += "<p><label>ADDRESS</label><input name='ADDRESS' class='txt medium' value='" + html_escape(person.ADDRESS) + "'/></p>";	html += "<p><button>Save</button></p>";	html += "</form>";		return html;}// TELEPHONESfunction reload_telephones() {	var p = DATA.getCurrentPerson();	$.get('/persons/' + p.ID + '/telephones').done(function(data) {		DATA.telephones = data.telephones;		render_telephones();	}).fail(function(response) {		var data = response.responseJSON;		$('#telephones').html(render_messages(data.messages));	});}function render_telephones() {	var p = DATA.getCurrentPerson();	var html = '';	html += "<p class='icon user_icon'>" + html_escape(p.NAME + " " + p.FAM) + "</p>";	html += "<table class='grid'>";	html += "<tr><th>ID</td><th>NOMER</th><th>TELTYPE</th><th></th></tr>";	for(var i=0; i<DATA.telephones.length; i++) {		var tel = DATA.telephones[i];		html += "<tr>"+			"<td>" + tel.ID + "</td>" +			"<td>" + html_escape(tel.NOMER) + "</td>" +			"<td>" + html_escape(DATA.getTelType(tel.TID).TELTYPE) + "</td>" +			"<td>" +				"<a href='#' data-id='" + tel.ID + "' class='icon edit_icon telephone-edit'>Edit</a> " +				"<a href='#' data-id='" + tel.ID + "' class='icon delete_icon telephone-delete'>Delete</a>" +			"</td>"+		"</tr>";	}	html += "</table>";	html += "<p>" +		"<a href='#' data-id='" + p.ID + "' class='icon add_icon telephone-add'>Add New Telephone</a> " +		"<a href='#' data-id='" + p.ID + "' class='icon refresh_icon telephones-refresh'>Refresh</a>" +		"</p>";	$('#telephones').html(html);}function render_telephone_form(telephone) {	var html = '';	var title = (telephone.ID) ? 'Edit Telephone' : 'Add Telephone';		html += "<h1>" + title + "</h1>";	html += "<form id='telephone-edit-form' action='#' method='post'>";	html += "<p><label>ID</label><input name='ID' class='txt medium' value='" + html_escape(telephone.ID) + "' readonly /></p>";	html += "<p><label>PID</label><input name='PID' class='txt medium' value='" + html_escape(telephone.PID) + "' readonly /></p>";	html += "<p><label>NOMER</label><input name='NOMER' class='txt medium' value='" + html_escape(telephone.NOMER) + "'/></p>";		html += "<p><label>TEL TYPE</label>";	html += "<select name='TID' class='txt medium'>";	html += "<option value=''> </option>";	for(var i = 0; i < DATA.teltypes.length; i++) {		var tt = DATA.teltypes[i];		var selected = (telephone.TID === tt.ID) ? 'selected' : '';		html += "<option value='" + tt.ID + "' " + selected + ">" + tt.TELTYPE + "</option>";	}	html += "</select>";	html += "</p>";	html += "<p><button>Save</button></p>";	html += "</form>";		return html;}function render_messages(messages) {	var html = '';	if(messages) {			for(var i = 0; i < messages.length; i++) {			var m = messages[i];			var css = (m.type === 'error') ? 'icon error_icon error' : 'icon info_icon info';			html += "<p class='" + css + "'>" + m.text + "</p>";		}	}	return html;}function html_escape(val) {		return (val+'')      .replace(/&/g, '&amp;')      .replace(/</g, '&lt;')      .replace(/>/g, '&gt;')      .replace(/\"/g, '&quot;')      .replace(/\'/g, '&apos;');}